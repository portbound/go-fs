<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>go-fs</title>
    <script src="/js/app.js" defer></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <style>
      [x-cloak] {
        display: none !important;
      }
    </style>
  </head>
  <body class="bg-gray-900 text-white font-sans">
    <div x-data="galleryApp()" x-cloak class="container mx-auto px-4 py-8">
      <!-- Toasts -->
      <div
        x-show="toasts.length > 0"
        class="fixed top-5 right-5 z-[100] w-80 space-y-3"
      >
        <template x-for="toast in toasts" :key="toast.id">
          <div
            @click="dismissToast(toast.id)"
            class="relative w-full cursor-pointer rounded-md border px-4 py-3 shadow-lg"
            :class="{
            'bg-red-500 border-red-700 text-white': toast.type === 'error',
            'bg-green-500 border-green-700 text-white': toast.type === 'success'
        }"
          >
            <p x-text="toast.message"></p>
          </div>
        </template>
      </div>

      <!-- Navbar -->
      <nav class="bg-gray-800 rounded-lg shadow-lg mb-8">
        <div class="mx-auto max-w-7xl px-4">
          <div class="flex justify-between h-16">
            <div class="flex items-center">
              <i class="fas fa-folder-open text-2xl text-indigo-400 mr-3"></i>
              <span class="text-xl font-bold">go-fs</span>
            </div>
            <div class="flex items-center space-x-4">
              <button
                @click="showUploadModal = true"
                class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg flex items-center transition-colors"
              >
                <i class="fas fa-upload mr-2"></i>
                <span>Upload</span>
              </button>
              <div class="relative">
                <button
                  @click="showNotifications = !showNotifications"
                  class="text-gray-300 hover:text-white"
                >
                  <i class="fas fa-bell text-xl"></i>
                  <span
                    x-show="notifications.length > 0"
                    class="absolute -top-1 -right-1 flex h-4 w-4 items-center justify-center rounded-full bg-red-500 text-xs"
                    x-text="notifications.length"
                  ></span>
                </button>
              </div>
              <button @click="logout()" class="text-gray-300 hover:text-white">
                <i class="fas fa-sign-out-alt text-xl"></i>
              </button>
            </div>
          </div>
        </div>
      </nav>

      <!-- Notifications Dropdown -->
      <div
        x-show="showNotifications"
        @click.away="showNotifications = false"
        class="absolute top-20 right-8 w-80 bg-gray-800 rounded-lg shadow-xl z-50 border border-gray-700"
        x-transition
      >
        <div class="p-4 border-b border-gray-700">
          <h3 class="font-bold">Notifications</h3>
        </div>
        <div class="p-4 max-h-80 overflow-y-auto">
          <template x-if="notifications.length === 0">
            <p class="text-gray-400">No new notifications.</p>
          </template>
          <template
            x-for="notification in notifications"
            :key="notification.id"
          >
            <div
              class="py-2 border-b border-gray-700/50 text-sm"
              x-text="notification.message"
            ></div>
          </template>
        </div>
      </div>

      <!-- Loading indicator -->
      <div x-show="isLoading" class="text-center py-16">
        <i class="fas fa-spinner fa-spin text-4xl text-indigo-400"></i>
        <p class="mt-4 text-lg">Loading files...</p>
      </div>

      <!-- File Grid -->
      <div x-show="!isLoading && Object.keys(filesByDate).length > 0">
        <template x-for="date in sortedDates" :key="date">
          <div>
            <h2
              class="text-xl font-bold text-gray-300 mt-8 mb-4"
              x-text="formatDate(date)"
            ></h2>
            <div
              class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-4"
            >
              <template x-for="file in filesByDate[date]" :key="file.id">
                <div
                  @click="handleFileClick(file)"
                  class="relative aspect-square bg-gray-800 rounded-lg overflow-hidden cursor-pointer group hover:shadow-lg hover:shadow-indigo-500/20 transition-shadow duration-300"
                >
                  <img
                    :src="file.thumbnailUrl"
                    :alt="`Thumbnail for ${file.name}`"
                    class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300"
                  />
                  <div
                    x-show="file.type.startsWith('video/')"
                    class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-20"
                  >
                    <i class="fas fa-play text-white text-3xl opacity-70"></i>
                  </div>
                  <div
                    class="absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end p-2"
                  >
                    <p
                      class="text-white text-xs font-medium truncate"
                      x-text="file.name"
                    ></p>
                  </div>
                </div>
              </template>
            </div>
          </div>
        </template>
      </div>

      <!-- Empty state -->
      <div
        x-show="!isLoading && Object.keys(filesByDate).length === 0"
        class="text-center py-16 bg-gray-800 rounded-lg"
      >
        <i class="fas fa-box-open text-4xl text-gray-500"></i>
        <p class="mt-4 text-lg text-gray-400">No files found.</p>
        <p class="text-sm text-gray-500">Upload some files to get started.</p>
      </div>

      <!-- Popover/Modal for file details -->
      <div
        x-show="showPopover"
        @keydown.escape.window="showPopover = false"
        class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4"
      >
        <div
          @click.away="showPopover = false"
          class="bg-gray-800 rounded-lg shadow-xl max-w-4xl w-full max-h-full overflow-y-auto"
        >
          <template x-if="selectedFile">
            <div class="p-6">
            <div class="flex justify-between items-start">
              <h3
                class="text-2xl font-bold mb-4"
                x-text="selectedFile.name"
              ></h3>
              <button
                @click="showPopover = false"
                class="text-gray-400 hover:text-white text-2xl"
              >
                &times;
              </button>
            </div>

            <div class="grid md:grid-cols-2 gap-6">
              <div>
                <template
                  x-if="selectedFile.type && selectedFile.type.startsWith('image/')"
                >
                  <img
                    :src="selectedFile.fullUrl"
                    :alt="selectedFile.name"
                    class="rounded-lg max-w-full h-auto max-h-96 mx-auto"
                  />
                </template>
                <template
                  x-if="selectedFile.type && selectedFile.type.startsWith('video/')"
                >
                  <video
                    controls
                    :src="selectedFile.fullUrl"
                    class="rounded-lg max-w-full h-auto max-h-96 mx-auto"
                  ></video>
                </template>
              </div>
              <div>
                <h4 class="font-bold text-lg mb-2">File Details</h4>
                <div class="space-y-2 text-gray-300">
                  <p>
                    <strong>Size:</strong>
                    <span x-text="formatBytes(selectedFile.size)"></span>
                  </p>
                  <p>
                    <strong>Type:</strong>
                    <span x-text="selectedFile.type"></span>
                  </p>
                  <p>
                    <strong>Owner:</strong>
                    <span x-text="selectedFile.owner"></span>
                  </p>
                  <p>
                    <strong>Uploaded:</strong>
                    <span
                      x-text="new Date(selectedFile.uploadDate).toLocaleString()"
                    ></span>
                  </p>
                </div>
                <div class="mt-6 grid grid-cols-2 sm:grid-cols-3 gap-3">
                  <button
                    @click="downloadFile(selectedFile)"
                    class="text-center bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-lg transition-colors flex items-center justify-center"
                  >
                    <i class="fas fa-download mr-2"></i> Download
                  </button>
                  <button
                    @click="openFullscreen()"
                    x-show="selectedFile.type && selectedFile.type.startsWith('image/')"
                    class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg transition-colors flex items-center justify-center"
                  >
                    <i class="fas fa-expand mr-2"></i> Expand
                  </button>
                  <button
                    @click="deleteFile(selectedFile)"
                    class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-6 rounded-lg transition-colors flex items-center justify-center"
                  >
                    <i class="fas fa-trash mr-2"></i> Delete
                  </button>
                </div>
              </div>
            </div>
          </template>
        </div>
      </div>

      <!-- Fullscreen Image Modal -->
      <div
        x-show="showFullscreenImage"
        @keydown.escape.window="showFullscreenImage = false"
        class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-[60]"
      >
        <img
          :src="fullscreenImageUrl"
          class="max-w-screen-xl max-h-screen object-contain"
        />
        <button
          @click="showFullscreenImage = false"
          class="absolute top-4 right-4 text-white hover:text-gray-300 text-4xl"
        >
          &times;
        </button>
      </div>

      <!-- Upload Modal -->
      <div
        x-show="showUploadModal"
        @keydown.escape.window="showUploadModal = false"
        class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4"
      >
        <div
          @click.away="showUploadModal = false"
          class="bg-gray-800 rounded-lg shadow-xl max-w-lg w-full"
        >
          <div class="p-6">
            <div class="flex justify-between items-start">
              <h3 class="text-2xl font-bold mb-4">Upload Files</h3>
              <button
                @click="showUploadModal = false"
                class="text-gray-400 hover:text-white text-2xl"
              >
                &times;
              </button>
            </div>
            <div x-show="!isUploading">
              <label
                for="file-upload"
                @dragover.prevent
                @drop.prevent="handleDrop"
                class="border-2 border-dashed border-gray-600 rounded-lg p-8 text-center cursor-pointer hover:border-indigo-400 hover:bg-gray-700 transition-colors block"
              >
                <input
                  type="file"
                  multiple
                  @change="handleFileSelect"
                  class="hidden"
                  id="file-upload"
                />
                <i
                  class="fas fa-cloud-upload-alt text-4xl text-gray-500 mb-4"
                ></i>
                <p>Drag and drop files here, or click to select files.</p>
              </label>
              <div
                x-show="filesToUpload.length > 0"
                class="mt-4 max-h-32 overflow-y-auto"
              >
                <p class="font-bold mb-2">Selected files:</p>
                <ul>
                  <template x-for="file in filesToUpload" :key="file.name">
                    <li
                      x-text="file.name"
                      class="text-sm text-gray-400 truncate"
                    ></li>
                  </template>
                </ul>
              </div>
            </div>
            <div x-show="isUploading" class="text-center py-8">
              <i class="fas fa-spinner fa-spin text-3xl text-indigo-400"></i>
              <p class="mt-3">Uploading...</p>
            </div>
            <div class="mt-6 text-right">
              <button
                @click="uploadFiles"
                :disabled="filesToUpload.length === 0 || isUploading"
                class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors"
              >
                Upload
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
